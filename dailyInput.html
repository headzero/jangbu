<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>

<body>

</body>

<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyDVEonurEpbMwfmBVGKp0jIbOBcv9ukht4",
        authDomain: "jangbu-3af0b.firebaseapp.com",
        databaseURL: "https://jangbu-3af0b.firebaseio.com",
        projectId: "jangbu-3af0b",
        storageBucket: "",
        messagingSenderId: "763168792123"
    };
    firebase.initializeApp(config);

    // Get a reference to the database service
    var database = firebase.database();


    // 월, 날짜 셀렉터에서 가져온다.
    // companyId, companyName, 잔여 전미수outstandingAccout는 회사정보에서 가져온다.
    // 회사 && 날짜 의 경우 중복으로 예외처리를 할 수 있도록 한다.
    function writeDailyData(date, companyId, companyName, radishCount, radishPrice, cabbageCount, cabbagePrice, etcCount, etcPrice, dailyTotal, outstandingAccout, discount, collect) {

        var month = date.substring(0, 7);
        var outstandingTotal = outstandingAccout + dailyTotal - discount - collect;

        var dailyKey = database.ref().child('daily').push().key;
        database.ref('daily/' + dailyKey).set({
            month: month,
            date: date,
            cId: companyId,
            cName: companyName,
            radishCount: radishCount,
            radishPrice: radishPrice,
            cabbageCount: cabbageCount,
            cabbagePrice: cabbagePrice,
            etcCount: etcCount,
            etcPrice: etcPrice,
            dailyTotal: dailyTotal,
            outstandingAccout: outstandingAccout, // 전미수
            discount: discount, // 할인
            collect: collect, // 입금
            outstandingTotal: outstandingTotal // 미수합계. -> 회사 전미술 업데이트 필요.
        });

        var updates = {};
        updates['/outstandingTotal'] = outstandingTotal;
        database.ref('company/' + companyId).update(updates);
    }

    // todo : 읽기 from key.
    
    // todo : 업데이트 데이터.
    
    // todo : 삭제 from key.
    
    // todo : 목록구현 from daily
    
    // todo : search from month || 회사명 || 날짜 범위.
</script>

</html>
